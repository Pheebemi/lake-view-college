{% extends 'app_manager/base.html' %}

{% block title %}Communication{% endblock %}
{% block page_title %}Communication Center{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-5">

    <!-- Send Notification Form -->
    <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="px-5 py-4 border-b border-gray-100 bg-gray-50">
                <h2 class="font-semibold text-gray-800">
                    <i class="fas fa-paper-plane mr-2 text-indigo-500"></i>Send Notification
                </h2>
            </div>

            <form method="POST" class="p-6 space-y-5">
                {% csrf_token %}

                <!-- Target Audience -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3">Send To:</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <label class="flex items-center space-x-2 p-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-indigo-400 transition has-[:checked]:border-indigo-500 has-[:checked]:bg-indigo-50">
                            <input type="radio" name="target" value="all" class="text-indigo-600" required>
                            <div>
                                <p class="text-sm font-medium text-gray-800">All Applicants</p>
                                <p class="text-xs text-gray-500">{{ total_applicants }} total</p>
                            </div>
                        </label>
                        <label class="flex items-center space-x-2 p-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-green-400 transition has-[:checked]:border-green-500 has-[:checked]:bg-green-50">
                            <input type="radio" name="target" value="admitted" class="text-green-600">
                            <div>
                                <p class="text-sm font-medium text-gray-800">Admitted</p>
                                <p class="text-xs text-gray-500">{{ admitted_count }} applicants</p>
                            </div>
                        </label>
                        <label class="flex items-center space-x-2 p-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-yellow-400 transition has-[:checked]:border-yellow-500 has-[:checked]:bg-yellow-50">
                            <input type="radio" name="target" value="pending" class="text-yellow-600">
                            <div>
                                <p class="text-sm font-medium text-gray-800">Pending Review</p>
                                <p class="text-xs text-gray-500">{{ pending_count }} applicants</p>
                            </div>
                        </label>
                        <label class="flex items-center space-x-2 p-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-red-400 transition has-[:checked]:border-red-500 has-[:checked]:bg-red-50">
                            <input type="radio" name="target" value="rejected" class="text-red-600">
                            <div>
                                <p class="text-sm font-medium text-gray-800">Rejected</p>
                                <p class="text-xs text-gray-500">{{ rejected_count }} applicants</p>
                            </div>
                        </label>
                        <label class="flex items-center space-x-2 p-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-blue-400 transition has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50">
                            <input type="radio" name="target" value="paid" class="text-blue-600">
                            <div>
                                <p class="text-sm font-medium text-gray-800">Paid Fee</p>
                                <p class="text-xs text-gray-500">Paid applicants</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Subject -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Subject (Optional)</label>
                    <input type="text" name="subject" placeholder="e.g. Important Admission Update"
                        class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-indigo-500">
                </div>

                <!-- Message -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Message</label>
                    <p class="text-xs text-gray-500 mb-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        Use <code class="bg-gray-100 px-1 rounded">{name}</code> to insert the applicant's full name
                    </p>
                    <textarea name="message" rows="6" required
                        placeholder="Dear {name}, ..."
                        class="w-full border border-gray-300 rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500 resize-y"></textarea>
                </div>

                <!-- Quick Templates -->
                <div>
                    <p class="text-sm font-semibold text-gray-700 mb-3">Quick Templates:</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                        <button type="button" onclick="useTemplate('admission')"
                            class="text-left px-4 py-3 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition">
                            <p class="text-xs font-semibold text-green-800"><i class="fas fa-check-circle mr-1"></i>Admission Offer</p>
                            <p class="text-xs text-green-600 truncate">Congratulations! You've been offered admission...</p>
                        </button>
                        <button type="button" onclick="useTemplate('documents')"
                            class="text-left px-4 py-3 bg-orange-50 border border-orange-200 rounded-lg hover:bg-orange-100 transition">
                            <p class="text-xs font-semibold text-orange-800"><i class="fas fa-file-alt mr-1"></i>Document Reminder</p>
                            <p class="text-xs text-orange-600 truncate">Please upload your required documents...</p>
                        </button>
                        <button type="button" onclick="useTemplate('interview')"
                            class="text-left px-4 py-3 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition">
                            <p class="text-xs font-semibold text-blue-800"><i class="fas fa-calendar mr-1"></i>Interview Notice</p>
                            <p class="text-xs text-blue-600 truncate">You are invited for a screening exercise...</p>
                        </button>
                        <button type="button" onclick="useTemplate('payment')"
                            class="text-left px-4 py-3 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 transition">
                            <p class="text-xs font-semibold text-purple-800"><i class="fas fa-money-bill mr-1"></i>Payment Reminder</p>
                            <p class="text-xs text-purple-600 truncate">Reminder to complete your screening fee payment...</p>
                        </button>
                    </div>
                </div>

                <button type="submit"
                    class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition text-sm">
                    <i class="fas fa-paper-plane mr-2"></i>Send Notification
                </button>
            </form>
        </div>
    </div>

    <!-- Sidebar Info -->
    <div class="space-y-5">
        <!-- Audience Summary -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5">
            <h3 class="font-semibold text-gray-800 mb-4">
                <i class="fas fa-users mr-2 text-gray-400"></i>Audience Summary
            </h3>
            <div class="space-y-3">
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">All Applicants</span>
                    <span class="text-sm font-bold text-gray-900">{{ total_applicants }}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Admitted</span>
                    <span class="text-sm font-bold text-green-600">{{ admitted_count }}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Pending Review</span>
                    <span class="text-sm font-bold text-yellow-600">{{ pending_count }}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Rejected</span>
                    <span class="text-sm font-bold text-red-600">{{ rejected_count }}</span>
                </div>
            </div>
        </div>

        <!-- Tips -->
        <div class="bg-indigo-50 rounded-xl border border-indigo-200 p-5">
            <h3 class="font-semibold text-indigo-800 mb-3">
                <i class="fas fa-lightbulb mr-2"></i>Tips
            </h3>
            <ul class="space-y-2 text-xs text-indigo-700">
                <li><i class="fas fa-check mr-1"></i>Use <code class="bg-white px-1 rounded">{name}</code> to personalise messages</li>
                <li><i class="fas fa-check mr-1"></i>Notifications appear in applicant dashboard</li>
                <li><i class="fas fa-check mr-1"></i>Use subject line to make messages easy to identify</li>
                <li><i class="fas fa-check mr-1"></i>Send specific notifications to targeted groups</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const templates = {
        admission: "Dear {name},\n\nCongratulations! You have been offered provisional admission to LakeView College of Education for the current academic session.\n\nPlease log in to your applicant dashboard to view your admission letter and next steps.\n\nWe look forward to welcoming you.\n\nAdmissions Office\nLakeView College of Education",
        documents: "Dear {name},\n\nThis is a reminder to upload your required documents on your applicant dashboard. Your application cannot be fully processed until all documents are submitted and verified.\n\nRequired Documents:\n- WAEC Result\n- JAMB Result Slip\n- Passport Photograph\n- Birth Certificate\n\nPlease log in and upload them as soon as possible.\n\nAdmissions Office",
        interview: "Dear {name},\n\nYou are hereby invited to attend the admission screening exercise at LakeView College of Education.\n\nDate: [Insert Date]\nTime: [Insert Time]\nVenue: [Insert Venue]\n\nPlease bring the following:\n- This notification\n- Original copies of all your documents\n- Writing materials\n\nAdmissions Office",
        payment: "Dear {name},\n\nThis is a reminder that your screening fee payment is still pending. Please log in to your applicant dashboard and complete your payment to access the screening form.\n\nYour application cannot proceed without payment.\n\nAdmissions Office\nLakeView College of Education"
    };

    function useTemplate(type) {
        const textarea = document.querySelector('textarea[name="message"]');
        if (textarea && templates[type]) {
            textarea.value = templates[type];
            textarea.scrollIntoView({ behavior: 'smooth' });
            textarea.focus();
        }
    }
</script>
{% endblock %}
